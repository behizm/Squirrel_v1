@using Squirrel.Domain.ViewModels
@model Squirrel.Domain.Enititis.Post
@{
    ViewBag.Title = "کامنت ها";
}

@if (ViewBag.ErrorMessage != null)
{
    @Html.Partial("_Message")
}
else
{
    <div class="col-lg-12" style="height: 30px; line-height: 30px; text-align: center;">
        <div id="comments_message_box" style="background-color: #f5f5dc"></div>
    </div>

    <div class="col-lg-12">
        <div style="margin-bottom: 10px; padding: 10px; background-color: #eee;">
            @Html.Partial("PostDetails")
        </div>
    </div>

    <div class="col-lg-12">
        <div style="margin: 10px 0; padding: 10px; background-color: #eee;">
            @Html.Partial("SearchFilter", new CommentSearchModel { PostId = Model.Id })
        </div>
        <div id="add_comment_loader" onclick="loadAddComment()">
            <button type="button" class="btn btn-default">+</button>
        </div>
        <div id="add_comment_content" style="display: none; border: 1px dashed #ddd; padding: 10px;">
            @Html.Partial("Add", new CommentAddModel { PostId = Model.Id })
        </div>
        <div id="list_con"></div>
    </div>
}

@section scripts
{
    <script type="text/javascript">
        $(function () {
            searchInComment(1);
        });

        function searchInComment(p) {
            $('#searchPage').val(p);
            $('#comment_search_from').submit();
        }

        function onSearchCommentBegin() {
            $('#list_con').text("waiting ...");
        }

        function onSearchCommentSuccess(data) {
            $('#list_con').html(data);
        }

        function loadAddComment() {
            $('#add_comment_loader').hide();
            $('#add_comment_content').show();
        }

        function cancelAddComment() {
            $('#add_comment_loader').show();
            $('#add_comment_content').hide();
        }

        function onAddCommentBegin() {
            $("#add_comment_form").submit();
        }

        function onAddCommentSuccess(data) {
            if (data.result == true) {
                cancelAddComment();
                showCommentMessage(data.message, '');
            } else {
                showCommentMessage('', data.message);
            }
        }

        function showCommentMessage(success, error) {
            $('#comments_message_box').text('').hide();
            if (success != '') {
                $('#comments_message_box').text(success).slideDown(200);
            } else if (error != '') {
                $('#comments_message_box').text(error).slideDown(200);
            }
        }
    </script>
}

