@using Squirrel.Domain.Enititis
@model Squirrel.Domain.ViewModels.PostEditModel

@{
    Post thisPost = ViewBag.CurrentPost;
}

عکس اصلی :
<p id="header_image_name">
    @if (thisPost.HeaderImageId.HasValue)
    {
        @Html.DisplayFor(m => thisPost.HeaderImage.Name)
    }
</p>
<p>
    @if (thisPost.HeaderImageId.HasValue)
    {
        <img id="header_image_pre" src="@Url.Content(thisPost.HeaderImage.Address)" style="width: 50%" />
    }
    else
    {
        <img id="header_image_pre" src="" style="width: 50%" />
    }
    <button type="button" onclick="loadImagesPopup()">ویرایش</button>
</p>

<div id="change_post_image_con">
    <div class="change-post-image">
        <div>عکس مورد نظر خود را انتخاب کنید.</div>
        <div id="change_post_image"></div>
        <button type="button" class="btn btn-success" onclick="confirmImagesPopup()">ثبت</button>
        <button type="button" class="btn btn-warning" onclick="closeImagesPopup()">بستن</button>
    </div>
</div>

@{
    const string targetKey = "HeaderImage";
}
@Html.Hidden(string.Format("{0}_id", targetKey))
@Html.Hidden(string.Format("{0}_name", targetKey))
@Html.Hidden(string.Format("{0}_address", targetKey))

<script type="text/javascript">
    $(function () {
        $(document).on('@string.Format("on{0}Choice", targetKey)', headerImageChoiceHandler);
        $(document).on('@string.Format("on{0}Pager", targetKey)', headerImagePagerHandler);
    });

    function loadImagesPopup() {
        $.ajax({
            url: '@Url.Action("Popup", "Files")',
            data: {
                Page: 1,
                TargetKey: '@targetKey',
                Type: '@FileType.Image',
                IsFixedType: true,
            },
            type: "POST",
            success: function (r) {
                $('#change_post_image').html(r);
                $('#change_post_image_con').css('display', 'flex');
            }
        });
    }

    function headerImageChoiceHandler(e) {
        $('@string.Format("#{0}_id", targetKey)').val(e.id);
        $('@string.Format("#{0}_name", targetKey)').val(e.name);
        $('@string.Format("#{0}_address", targetKey)').val(e.address);
    }

    function headerImagePagerHandler(e) {
        $('#change_post_image').html(e.content);
    }

    function closeImagesPopup() {
        $('@string.Format("#{0}_id", targetKey)').val('');
        $('@string.Format("#{0}_name", targetKey)').val('');
        $('@string.Format("#{0}_address", targetKey)').val('');
        $('#change_post_image_con').css('display', 'none');
    }

    function confirmImagesPopup() {
        $('#HeaderImageId').val($('@string.Format("#{0}_id", targetKey)').val());
        $('#header_image_name').text($('@string.Format("#{0}_name", targetKey)').val());
        $('#header_image_address').text($('@string.Format("#{0}_address", targetKey)').val());
        $('#header_image_pre').attr('src', '@Url.Content("~")' + $('@string.Format("#{0}_address", targetKey)').val().replace("~/", ""));
        closeImagesPopup();
    }

</script>

<style type="text/css">
    #change_post_image_con {
        position: fixed;
        z-index: 10000;
        background-color: #000000;
        background-color: rgba(0,0,0,.8);
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        /*display: flex;*/
        display: none;
        align-items: center;
        justify-content: center;
    }

        #change_post_image_con .change-post-image {
            background-color: #fff;
            width: 80%;
            padding: 20px 30px;
        }
</style>